<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Four Keys - GitHub PR Dashboard</title>
    <link rel="stylesheet" href="css/style.css?v=20251113-16">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="js/i18n.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 data-i18n="github_pr_tools">GitHub PR Tools</h1>
                <div style="display: flex; gap: 0.5rem;">
                    <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">
                        <span id="themeIcon">🌙</span>
                    </button>
                    <button id="langToggle" class="lang-toggle" onclick="toggleLanguage()">EN</button>
                </div>
            </div>

            <div class="sidebar-content">
                <!-- Repository Filter in Sidebar -->
                <div class="sidebar-filter">
                    <label for="globalRepoFilter" style="display: block; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem;">
                        📁 リポジトリフィルタ
                    </label>
                    <select id="globalRepoFilter" class="sidebar-select" onchange="handleGlobalRepoFilterChange()">
                        <option value="">すべてのリポジトリ</option>
                    </select>
                </div>

                <nav class="sidebar-nav">
                    <a href="index.html" class="nav-item" data-page="home">
                        <span class="nav-icon">🏠</span>
                        <span class="nav-label" data-i18n="nav.home">ホーム</span>
                    </a>
                    <a href="dashboard.html" class="nav-item" data-page="dashboard">
                        <span class="nav-icon">📊</span>
                        <span class="nav-label" data-i18n="nav.dashboard">PRダッシュボード</span>
                    </a>
                    <a href="analytics.html" class="nav-item" data-page="analytics">
                        <span class="nav-icon">📈</span>
                        <span class="nav-label" data-i18n="nav.analytics">PR分析</span>
                    </a>
                    <a href="fourkeys.html" class="nav-item active" data-page="fourkeys">
                        <span class="nav-icon">🔑</span>
                        <span class="nav-label" data-i18n="nav.fourkeys">Four Keys</span>
                    </a>
                    <a href="statistics.html" class="nav-item" data-page="statistics">
                        <span class="nav-icon">📊</span>
                        <span class="nav-label" data-i18n="nav.statistics">統計・レポート</span>
                    </a>
                    <a href="file-history.html" class="nav-item" data-page="file-history">
                        <span class="nav-icon">📁</span>
                        <span class="nav-label" data-i18n="nav.filehistory">ファイル履歴</span>
                    </a>
                    <a href="issues.html" class="nav-item" data-page="issues">
                        <span class="nav-icon">🎯</span>
                        <span class="nav-label" data-i18n="nav.issues">Issue管理</span>
                    </a>
                </nav>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Back Button - Hidden by default -->
            <button id="back-button" class="back-button" onclick="goBack()" style="display: none;">
                <span class="back-icon">←</span>
                <span class="back-label">戻る</span>
            </button>

            <!-- Global Repository Selection Info - Always Visible -->
            <div id="globalRepoInfo" class="global-repo-info">
                <div class="repo-info-content">
                    <span class="repo-info-icon">📁</span>
                    <span class="repo-info-label">現在のリポジトリ:</span>
                    <span id="globalRepoName" class="repo-info-name">すべてのリポジトリ</span>
                </div>
            </div>

            <!-- Four Keys Page -->
            <div id="page-fourkeys" class="page active">
                <div class="page-header">
                    <h1 data-i18n="fourkeys.title">🔑 Four Keys メトリクス</h1>
                    <p class="page-subtitle" data-i18n="fourkeys.subtitle">
                        DevOps Research and Assessment (DORA) の 4つの主要指標でソフトウェア開発のパフォーマンスを測定<br>
                        <small style="color: var(--text-muted); font-size: 0.9rem;">💡 サイドバーのリポジトリフィルタで特定のリポジトリに絞り込めます</small>
                    </p>
                </div>

                <div class="dev-banner" id="fourkeys-dev-banner">
                    <div class="dev-banner-content">
                        <span class="dev-banner-icon">⚠️</span>
                        <div>
                            <h3>データが読み込めませんでした</h3>
                            <p>Four Keys メトリクスのデータファイル (fourkeys.json) が見つからないか、読み込みに失敗しました。</p>
                            <p>データは GitHub Actions により自動生成されます。しばらくお待ちください。</p>
                        </div>
                    </div>
                </div>

                <div id="fourkeys-content">
                    <!-- 1. サマリーセクション -->
                    <div class="chart-section">
                        <h2>📊 メトリクスサマリー</h2>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">現在のパフォーマンスレベルを一目で確認</p>
                        <div class="metrics-grid">
                            <div class="metric-card modern-card" id="deployment-frequency">
                                <div class="metric-card-header">
                                    <span class="metric-icon">📦</span>
                                    <h3>Deployment Frequency</h3>
                                </div>
                                <div class="metric-card-body">
                                    <div class="metric-value-container">
                                        <p class="metric-value loading">-</p>
                                        <p class="metric-unit"></p>
                                    </div>
                                    <p class="metric-description">デプロイ頻度</p>
                                    <div class="metric-badge"></div>
                                </div>
                            </div>

                            <div class="metric-card modern-card" id="lead-time">
                                <div class="metric-card-header">
                                    <span class="metric-icon">⏱️</span>
                                    <h3>Lead Time for Changes</h3>
                                </div>
                                <div class="metric-card-body">
                                    <div class="metric-value-container">
                                        <p class="metric-value loading">-</p>
                                        <p class="metric-unit"></p>
                                    </div>
                                    <p class="metric-description">変更のリードタイム</p>
                                    <div class="metric-badge"></div>
                                </div>
                            </div>

                            <div class="metric-card modern-card" id="change-failure-rate">
                                <div class="metric-card-header">
                                    <span class="metric-icon">❌</span>
                                    <h3>Change Failure Rate</h3>
                                </div>
                                <div class="metric-card-body">
                                    <div class="metric-value-container">
                                        <p class="metric-value loading">-</p>
                                        <p class="metric-unit"></p>
                                    </div>
                                    <p class="metric-description">変更失敗率</p>
                                    <div class="metric-badge"></div>
                                </div>
                            </div>

                            <div class="metric-card modern-card" id="mttr">
                                <div class="metric-card-header">
                                    <span class="metric-icon">🔧</span>
                                    <h3>Time to Restore Service</h3>
                                </div>
                                <div class="metric-card-body">
                                    <div class="metric-value-container">
                                        <p class="metric-value loading">-</p>
                                        <p class="metric-unit"></p>
                                    </div>
                                    <p class="metric-description">サービス復旧時間 (MTTR)</p>
                                    <div class="metric-badge"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. 総合ビューセクション -->
                    <div class="chart-section">
                        <h2>🎯 総合パフォーマンスビュー</h2>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">4つのメトリクスのバランスをレーダーチャートで可視化</p>
                        <div id="fourkeys-radar-chart" class="chart-container" style="height: 500px;"></div>
                    </div>

                    <!-- 3. トレンド分析セクション -->
                    <div class="chart-section">
                        <h2>📈 トレンド分析</h2>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">各メトリクスの時系列推移を確認</p>
                        <div class="fourkeys-quadrant-grid">
                            <div class="quadrant-item">
                                <h3>Deployment Frequency</h3>
                                <div id="fourkeys-quad-df" class="chart-container" style="height: 300px;"></div>
                                <div class="quadrant-metric" id="quad-df-metric"></div>
                            </div>
                            <div class="quadrant-item">
                                <h3>Lead Time for Changes</h3>
                                <div id="fourkeys-quad-lt" class="chart-container" style="height: 300px;"></div>
                                <div class="quadrant-metric" id="quad-lt-metric"></div>
                            </div>
                            <div class="quadrant-item">
                                <h3>Change Failure Rate</h3>
                                <div id="fourkeys-quad-cfr" class="chart-container" style="height: 300px;"></div>
                                <div class="quadrant-metric" id="quad-cfr-metric"></div>
                            </div>
                            <div class="quadrant-item">
                                <h3>Mean Time to Restore</h3>
                                <div id="fourkeys-quad-mttr" class="chart-container" style="height: 300px;"></div>
                                <div class="quadrant-metric" id="quad-mttr-metric"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 4. 詳細分析セクション -->
                    <div class="chart-section">
                        <h2>🔍 詳細分析</h2>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">各メトリクスの詳細データと分布を確認</p>
                        <div class="tabs">
                            <button class="tab-btn active" data-tab="df-detail">Deployment Frequency</button>
                            <button class="tab-btn" data-tab="lt-detail">Lead Time</button>
                            <button class="tab-btn" data-tab="cfr-detail">Change Failure Rate</button>
                            <button class="tab-btn" data-tab="mttr-detail">MTTR</button>
                        </div>
                        <div class="tab-content">
                            <div id="tab-df-detail" class="tab-pane active">
                                <div id="fourkeys-df-detail" class="chart-container" style="height: 400px;"></div>
                                <div id="fourkeys-df-table"></div>
                            </div>
                            <div id="tab-lt-detail" class="tab-pane">
                                <div id="fourkeys-lt-detail" class="chart-container" style="height: 400px;"></div>
                                <div id="fourkeys-lt-table"></div>
                            </div>
                            <div id="tab-cfr-detail" class="tab-pane">
                                <div id="fourkeys-cfr-detail" class="chart-container" style="height: 400px;"></div>
                                <div id="fourkeys-cfr-table"></div>
                            </div>
                            <div id="tab-mttr-detail" class="tab-pane">
                                <div id="fourkeys-mttr-detail" class="chart-container" style="height: 400px;"></div>
                                <div id="fourkeys-mttr-table"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 5. 改善アクションセクション -->
                    <div class="chart-section">
                        <h2>💡 改善アクション</h2>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">各メトリクスを向上させるための具体的な施策</p>
                        <div class="improvement-hints">
                            <div class="hint-card">
                                <h4>Deployment Frequency を上げるには:</h4>
                                <ul>
                                    <li>PR サイズを小さくする</li>
                                    <li>CI/CD パイプラインを高速化</li>
                                    <li>フィーチャーフラグを活用</li>
                                </ul>
                            </div>
                            <div class="hint-card">
                                <h4>Lead Time を短縮するには:</h4>
                                <ul>
                                    <li>PRレビューを迅速化</li>
                                    <li>自動テストを充実</li>
                                    <li>PR作成前のコミュニケーション強化</li>
                                </ul>
                            </div>
                            <div class="hint-card">
                                <h4>Change Failure Rate を下げるには:</h4>
                                <ul>
                                    <li>テストカバレッジ向上</li>
                                    <li>Canary デプロイメント導入</li>
                                    <li>プレプロダクション環境の活用</li>
                                </ul>
                            </div>
                            <div class="hint-card">
                                <h4>MTTR を短縮するには:</h4>
                                <ul>
                                    <li>モニタリング・アラート強化</li>
                                    <li>ロールバック手順の自動化</li>
                                    <li>インシデント対応訓練</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/config.js?v=20251113-17"></script>
    <script src="js/utils.js?v=20251113-18"></script>
    <script src="js/action-tracker.js?v=20251113-18"></script>
    <script src="js/app.js?v=20251113-18"></script>
    <script src="js/fourkeys.js?v=20251113-18"></script>
</body>
</html>