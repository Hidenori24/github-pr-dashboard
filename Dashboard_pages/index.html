<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub PR Dashboard</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="js/i18n.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 data-i18n="github_pr_tools">GitHub PR Tools</h1>
                <div style="display: flex; gap: 0.5rem;">
                    <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">
                        <span id="themeIcon">🌙</span>
                    </button>
                    <button id="langToggle" class="lang-toggle" onclick="toggleLanguage()">EN</button>
                </div>
            </div>
            
            <div class="sidebar-content">
                <div class="primary-repo" id="primaryRepoInfo">
                    <div class="loading">Loading...</div>
                </div>
                
                <nav class="sidebar-nav">
                    <a href="#home" class="nav-item active" data-page="home">
                        <span class="nav-icon">🏠</span>
                        <span class="nav-label" data-i18n="nav.home">ホーム</span>
                    </a>
                    <a href="#dashboard" class="nav-item" data-page="dashboard">
                        <span class="nav-icon">📊</span>
                        <span class="nav-label" data-i18n="nav.dashboard">PRダッシュボード</span>
                    </a>
                    <a href="#analytics" class="nav-item" data-page="analytics">
                        <span class="nav-icon">📈</span>
                        <span class="nav-label" data-i18n="nav.analytics">PR分析</span>
                    </a>
                    <a href="#fourkeys" class="nav-item" data-page="fourkeys">
                        <span class="nav-icon">🔑</span>
                        <span class="nav-label" data-i18n="nav.fourkeys">Four Keys</span>
                    </a>
                    <a href="#statistics" class="nav-item" data-page="statistics">
                        <span class="nav-icon">📊</span>
                        <span class="nav-label" data-i18n="nav.statistics">統計・レポート</span>
                    </a>
                </nav>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Home Page -->
            <div id="page-home" class="page active">
                <h1 data-i18n="home.title">GitHub PR Dashboard & Analytics</h1>
                
                <p class="lead-text" data-i18n="home.subtitle">
                    GitHubのPRを可視化・分析する統合ダッシュボード
                </p>

                <div class="feature-cards">
                    <div class="card">
                        <h3 data-i18n="home.features.title">主な機能</h3>
                        <ul>
                            <li><strong data-i18n="home.features.multi">マルチリポジトリ対応</strong>: <span data-i18n="home.features.multi.desc">複数リポジトリを一元管理</span></li>
                            <li><strong data-i18n="home.features.comment">コメントスレッド分析</strong>: <span data-i18n="home.features.comment.desc">指摘→返信→解決の流れを可視化</span></li>
                            <li><strong data-i18n="home.features.bottleneck">ボトルネック分析</strong>: <span data-i18n="home.features.bottleneck.desc">未応答時間を営業日ベースで計算</span></li>
                            <li><strong data-i18n="home.features.reviewer">レビュワー分析</strong>: <span data-i18n="home.features.reviewer.desc">誰がレビューに応答していないかを特定</span></li>
                            <li><strong data-i18n="home.features.speed">レビュー速度分析</strong>: <span data-i18n="home.features.speed.desc">作成からマージまでの時間分析</span></li>
                            <li><strong data-i18n="home.features.pattern">変更パターン分析</strong>: <span data-i18n="home.features.pattern.desc">ファイル変更頻度とPR規模分析</span></li>
                        </ul>
                    </div>
                </div>

                <h2 data-i18n="home.repos.title">設定済みリポジトリ</h2>
                <p class="info-text" data-i18n="home.repos.select">プライマリーリポジトリを選択してください</p>
                <div id="repoList" class="repo-grid">
                    <div class="loading" data-i18n="home.repos.loading">Loading repositories...</div>
                </div>

                <div id="selectedRepoInfo" class="selected-repo-info"></div>

                <hr class="divider">

                <div id="cacheStatus" class="cache-status">
                    <div class="loading" data-i18n="home.cache.checking">Checking cache status...</div>
                </div>

                <hr class="divider">

                <div class="feature-grid">
                    <div class="feature-card" data-page="dashboard">
                        <h3 data-i18n="dashboard.title">PRダッシュボード</h3>
                        <p><strong data-i18n="dashboard.purpose">目的:</strong> <span data-i18n="dashboard.purpose.desc">PRの状態とファイル変更を時系列で把握</span></p>
                        <h4 data-i18n="dashboard.features.title">主な機能:</h4>
                        <ul>
                            <li><strong data-i18n="dashboard.timeline">PRタイムライン</strong>: <span data-i18n="dashboard.timeline.desc">ガントチャートでPRのライフサイクルを可視化</span></li>
                            <li><strong data-i18n="dashboard.files">書類/コード分析</strong>: <span data-i18n="dashboard.files.desc">ディレクトリごとのPRタイムライン</span></li>
                            <li><strong data-i18n="dashboard.action">アクション追跡</strong>: <span data-i18n="dashboard.action.desc">レビュー待ち/修正待ちPRの自動検出</span></li>
                        </ul>
                        <button class="btn btn-primary" onclick="navigateToPage('dashboard')" data-i18n="dashboard.open">
                            PRダッシュボードを開く
                        </button>
                    </div>

                    <div class="feature-card" data-page="analytics">
                        <h3 data-i18n="analytics.title">PR分析</h3>
                        <p><strong data-i18n="analytics.purpose">目的:</strong> <span data-i18n="analytics.purpose.desc">PRの統計分析と問題の早期発見</span></p>
                        <h4 data-i18n="analytics.features.title">7つの分析タブ:</h4>
                        <ul>
                            <li><span data-i18n="analytics.stagnation">滞留分析</span>: <span data-i18n="analytics.stagnation.desc">OPEN PRの滞留時間分布</span></li>
                            <li><span data-i18n="analytics.blocker">ブロッカー分析</span>: <span data-i18n="analytics.blocker.desc">未クローズ原因の推定</span></li>
                            <li><span data-i18n="analytics.reviewer">レビュワー分析</span>: <span data-i18n="analytics.reviewer.desc">レビューアクティビティ</span></li>
                            <li><span data-i18n="analytics.trend">トレンド分析</span>: <span data-i18n="analytics.trend.desc">週次PR作成数推移</span></li>
                            <li>ボトルネック分析: レビュー待ち/修正待ち</li>
                            <li>レビュー速度: マージまでの時間分析</li>
                            <li>変更パターン: ファイル変更頻度</li>
                        </ul>
                        <button class="btn btn-primary" onclick="navigateToPage('analytics')" data-i18n="analytics.open">
                            PR分析を開く
                        </button>
                    </div>

                    <div class="feature-card" data-page="fourkeys">
                        <h3 data-i18n="fourkeys.title">Four Keys</h3>
                        <p><strong data-i18n="fourkeys.purpose">目的:</strong> <span data-i18n="fourkeys.purpose.desc">DevOps Research and Assessment (DORA) の主要指標でソフトウェア開発のパフォーマンスを測定</span></p>
                        <h4 data-i18n="fourkeys.features.title">4つの主要指標:</h4>
                        <ul>
                            <li><strong>Deployment Frequency</strong>: <span data-i18n="fourkeys.deployment">デプロイ頻度 - 週あたりのデプロイ回数</span></li>
                            <li><strong>Lead Time for Changes</strong>: <span data-i18n="fourkeys.leadtime">変更のリードタイム - PR作成からマージまでの時間</span></li>
                            <li><strong>Change Failure Rate</strong>: <span data-i18n="fourkeys.failure">変更失敗率 - 失敗PRの割合</span></li>
                            <li><strong>Time to Restore Service</strong>: <span data-i18n="fourkeys.mttr">サービス復旧時間 (MTTR) - 問題解決までの時間</span></li>
                        </ul>
                        <button class="btn btn-primary" onclick="navigateToPage('fourkeys')" data-i18n="fourkeys.open">
                            Four Keysを開く
                        </button>
                    </div>
                </div>

                <hr class="divider">

                <div class="tips-grid">
                    <div class="tip-card tip-info">
                        <h4>📊 データ更新</h4>
                        <p>GitHub Actionsにより自動更新されます</p>
                        <ul>
                            <li>定期実行: 毎日自動更新</li>
                            <li>手動実行: Actions タブから実行可能</li>
                            <li>リアルタイム: 最新データを常に表示</li>
                        </ul>
                    </div>

                    <div class="tip-card tip-success">
                        <h4>⚡ 高速表示</h4>
                        <p>静的ページで瞬時に表示</p>
                        <ul>
                            <li>ページロード: 0.1秒以下</li>
                            <li>GitHub API呼び出し不要</li>
                            <li>Rate Limitの心配なし</li>
                        </ul>
                    </div>

                    <div class="tip-card tip-warning">
                        <h4>🔍 分析機能</h4>
                        <p>コメントスレッド分析で未応答を特定</p>
                        <ul>
                            <li>指摘→返信→解決の流れを追跡</li>
                            <li>営業日ベースの未応答時間</li>
                            <li>レビュワー別の応答率可視化</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page">
                <h1>PRダッシュボード</h1>
                
                <div class="dashboard-controls">
                    <div class="control-group">
                        <label for="repoFilter">リポジトリ:</label>
                        <select id="repoFilter" class="form-select">
                            <option value="">Loading...</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="stateFilter">状態:</label>
                        <select id="stateFilter" class="form-select" multiple>
                            <option value="OPEN" selected>Open</option>
                            <option value="MERGED" selected>Merged</option>
                            <option value="CLOSED">Closed</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="daysFilter">期間:</label>
                        <select id="daysFilter" class="form-select">
                            <option value="30">過去30日</option>
                            <option value="60">過去60日</option>
                            <option value="90" selected>過去90日</option>
                            <option value="180">過去180日</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" onclick="loadDashboardData()">
                        更新
                    </button>
                </div>

                <div class="metrics-row" id="dashboardMetrics">
                    <!-- Metrics will be inserted here -->
                </div>

                <div class="chart-container">
                    <h2>PRタイムライン</h2>
                    <div id="timelineChart" class="chart-area">
                        <div class="loading">Loading chart...</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h2>PR一覧</h2>
                    <div id="prTable" class="table-container">
                        <div class="loading">Loading table...</div>
                    </div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="page-analytics" class="page">
                <h1>PR分析</h1>
                
                <div class="tabs">
                    <button class="tab-btn active" data-tab="residence">滞留分析</button>
                    <button class="tab-btn" data-tab="blocker">ブロッカー分析</button>
                    <button class="tab-btn" data-tab="reviewer">レビュワー分析</button>
                    <button class="tab-btn" data-tab="trend">トレンド分析</button>
                    <button class="tab-btn" data-tab="bottleneck">ボトルネック分析</button>
                    <button class="tab-btn" data-tab="speed">レビュー速度</button>
                    <button class="tab-btn" data-tab="pattern">変更パターン</button>
                </div>

                <div class="tab-content">
                    <div id="tab-residence" class="tab-pane active">
                        <h2>滞留分析</h2>
                        <p>Open PRの滞留時間分布</p>
                        <div id="residenceChart" class="chart-area">
                            <div class="loading">Loading chart...</div>
                        </div>
                    </div>

                    <div id="tab-blocker" class="tab-pane">
                        <h2>ブロッカー分析</h2>
                        <p>未クローズ原因の推定</p>
                        <div id="blockerChart" class="chart-area">
                            <div class="loading">Loading chart...</div>
                        </div>
                    </div>

                    <div id="tab-reviewer" class="tab-pane">
                        <h2>レビュワー分析</h2>
                        <p>レビューアクティビティとコメント応答状況</p>
                        <div id="reviewerChart" class="chart-area">
                            <div class="loading">Loading chart...</div>
                        </div>
                    </div>

                    <div id="tab-trend" class="tab-pane">
                        <h2>トレンド分析</h2>
                        <p>週次PR作成数推移</p>
                        <div id="trendChart" class="chart-area">
                            <div class="loading">Loading chart...</div>
                        </div>
                    </div>

                    <div id="tab-bottleneck" class="tab-pane">
                        <h2>ボトルネック分析</h2>
                        <p>レビュー待ち/修正待ちの詳細</p>
                        <div id="bottleneckChart" class="chart-area">
                            <div class="loading">Loading chart...</div>
                        </div>
                    </div>

                    <div id="tab-speed" class="tab-pane">
                        <h2>レビュー速度</h2>
                        <p>マージまでの時間分析</p>
                        <div id="speedChart" class="chart-area">
                            <div class="loading">Loading chart...</div>
                        </div>
                    </div>

                    <div id="tab-pattern" class="tab-pane">
                        <h2>変更パターン</h2>
                        <p>ファイル変更頻度とPR規模</p>
                        <div id="patternChart" class="chart-area">
                            <div class="loading">Loading chart...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Four Keys Page -->
            <div id="page-fourkeys" class="page">
                <div class="page-header">
                    <h1 data-i18n="fourkeys.title">🔑 Four Keys メトリクス</h1>
                    <p class="page-subtitle" data-i18n="fourkeys.subtitle">
                        DevOps Research and Assessment (DORA) の 4つの主要指標でソフトウェア開発のパフォーマンスを測定
                    </p>
                </div>
                
                <div class="dev-banner" id="fourkeys-dev-banner">
                    <div class="dev-banner-content">
                        <span class="dev-banner-icon">🚧</span>
                        <div>
                            <h3>データの生成が必要です</h3>
                            <p>Four Keys メトリクスを表示するには、データ生成スクリプトを実行してください。</p>
                            <code>python Dashboard_pages/generate_data.py</code>
                        </div>
                    </div>
                </div>

                <div id="fourkeys-content">
                    <!-- Metrics Cards Grid -->
                    <div class="metrics-grid">
                        <div class="metric-card modern-card" id="deployment-frequency">
                            <div class="metric-card-header">
                                <span class="metric-icon">📦</span>
                                <h3>Deployment Frequency</h3>
                            </div>
                            <div class="metric-card-body">
                                <div class="metric-value-container">
                                    <p class="metric-value loading">-</p>
                                    <p class="metric-unit"></p>
                                </div>
                                <p class="metric-description">デプロイ頻度</p>
                                <div class="metric-badge"></div>
                            </div>
                        </div>

                        <div class="metric-card modern-card" id="lead-time">
                            <div class="metric-card-header">
                                <span class="metric-icon">⏱️</span>
                                <h3>Lead Time for Changes</h3>
                            </div>
                            <div class="metric-card-body">
                                <div class="metric-value-container">
                                    <p class="metric-value loading">-</p>
                                    <p class="metric-unit"></p>
                                </div>
                                <p class="metric-description">変更のリードタイム</p>
                                <div class="metric-badge"></div>
                            </div>
                        </div>

                        <div class="metric-card modern-card" id="change-failure-rate">
                            <div class="metric-card-header">
                                <span class="metric-icon">❌</span>
                                <h3>Change Failure Rate</h3>
                            </div>
                            <div class="metric-card-body">
                                <div class="metric-value-container">
                                    <p class="metric-value loading">-</p>
                                    <p class="metric-unit"></p>
                                </div>
                                <p class="metric-description">変更失敗率</p>
                                <div class="metric-badge"></div>
                            </div>
                        </div>

                        <div class="metric-card modern-card" id="mttr">
                            <div class="metric-card-header">
                                <span class="metric-icon">🔧</span>
                                <h3>Time to Restore Service</h3>
                            </div>
                            <div class="metric-card-body">
                                <div class="metric-value-container">
                                    <p class="metric-value loading">-</p>
                                    <p class="metric-unit"></p>
                                </div>
                                <p class="metric-description">サービス復旧時間 (MTTR)</p>
                                <div class="metric-badge"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts will be inserted here by JavaScript -->
                    <div id="fourkeys-charts" class="fourkeys-charts-container"></div>
                </div>
            </div>

            <!-- Statistics Page -->
            <div id="page-statistics" class="page">
                <div class="page-header">
                    <h1>📊 統計情報・週間レポート</h1>
                    <p class="page-subtitle">
                        開発プロセスの現状を理解し、改善の機会を見つけるための包括的な統計情報
                    </p>
                </div>

                <!-- Controls -->
                <div class="statistics-controls">
                    <div class="control-group">
                        <label for="periodSelect">レポート期間:</label>
                        <select id="periodSelect" class="form-select">
                            <option value="thisWeek">今週</option>
                            <option value="lastWeek">先週</option>
                            <option value="thisMonth">今月</option>
                            <option value="lastMonth">先月</option>
                            <option value="last30days">過去30日</option>
                            <option value="last90days">過去90日</option>
                        </select>
                    </div>
                    <button id="downloadReport" class="btn btn-primary">
                        📄 週間レポートをダウンロード
                    </button>
                </div>

                <!-- Summary Cards -->
                <div class="statistics-summary">
                    <h2>📅 期間サマリー</h2>
                    <div class="metrics-grid">
                        <div class="metric-card modern-card" id="totalPRsCard">
                            <div class="metric-card-header">
                                <span class="metric-icon">📋</span>
                                <h3>総PR数</h3>
                            </div>
                            <div class="metric-card-body">
                                <div class="metric-value-container">
                                    <p class="metric-value">-</p>
                                </div>
                                <p class="metric-delta"></p>
                            </div>
                        </div>

                        <div class="metric-card modern-card" id="mergedPRsCard">
                            <div class="metric-card-header">
                                <span class="metric-icon">✅</span>
                                <h3>マージ済み</h3>
                            </div>
                            <div class="metric-card-body">
                                <div class="metric-value-container">
                                    <p class="metric-value">-</p>
                                </div>
                                <p class="metric-delta"></p>
                            </div>
                        </div>

                        <div class="metric-card modern-card" id="leadTimeCard">
                            <div class="metric-card-header">
                                <span class="metric-icon">⏱️</span>
                                <h3>平均リードタイム</h3>
                            </div>
                            <div class="metric-card-body">
                                <div class="metric-value-container">
                                    <p class="metric-value">-</p>
                                </div>
                                <p class="metric-delta"></p>
                            </div>
                        </div>

                        <div class="metric-card modern-card" id="activeAuthorsCard">
                            <div class="metric-card-header">
                                <span class="metric-icon">👥</span>
                                <h3>アクティブ開発者</h3>
                            </div>
                            <div class="metric-card-body">
                                <div class="metric-value-container">
                                    <p class="metric-value">-</p>
                                </div>
                                <p class="metric-delta"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="statistics-charts">
                    <div class="chart-row">
                        <div class="chart-container half-width">
                            <h3>PR状態の内訳</h3>
                            <div id="stateChart" class="chart-placeholder"></div>
                        </div>
                        <div class="chart-container half-width">
                            <h3>レビュー活動</h3>
                            <div id="reviewMetrics" class="review-metrics"></div>
                        </div>
                    </div>
                </div>

                <!-- Trends Section -->
                <div class="statistics-trends">
                    <h2>📈 トレンド分析（過去8週間）</h2>
                    <div class="chart-row">
                        <div class="chart-container half-width">
                            <h3>PR作成数の推移</h3>
                            <div id="trendPRChart" class="chart-placeholder"></div>
                        </div>
                        <div class="chart-container half-width">
                            <h3>平均リードタイムの推移</h3>
                            <div id="trendLeadTimeChart" class="chart-placeholder"></div>
                        </div>
                    </div>
                </div>

                <!-- Insights Section -->
                <div class="statistics-insights">
                    <h2>💡 洞察</h2>
                    <div id="insightsContainer" class="insights-container">
                        <div class="loading">データを分析中...</div>
                    </div>
                </div>

                <!-- Recommendations Section -->
                <div class="statistics-recommendations">
                    <h2>🎯 改善提案</h2>
                    <div id="recommendationsContainer" class="recommendations-container">
                        <div class="loading">提案を生成中...</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/config.js"></script>
    <script src="js/app.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/fourkeys.js"></script>
    <script src="js/statistics.js"></script>
</body>
</html>
