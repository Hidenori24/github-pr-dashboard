<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub PR Dashboard</title>
    <link rel="stylesheet" href="css/style.css?v=20251113-16">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="js/i18n.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 data-i18n="github_pr_tools">GitHub PR Tools</h1>
                <div style="display: flex; gap: 0.5rem;">
                    <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">
                        <span id="themeIcon">🌙</span>
                    </button>
                    <button id="langToggle" class="lang-toggle" onclick="toggleLanguage()">EN</button>
                </div>
            </div>
            
            <div class="sidebar-content">
                <!-- Repository Filter in Sidebar -->
                <div class="sidebar-filter">
                    <label for="globalRepoFilter" style="display: block; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem;">
                        📁 リポジトリフィルタ
                    </label>
                    <select id="globalRepoFilter" class="sidebar-select" onchange="handleGlobalRepoFilterChange()">
                        <option value="">すべてのリポジトリ</option>
                    </select>
                </div>
                
                <nav class="sidebar-nav">
                    <a href="#home" class="nav-item active" data-page="home">
                        <span class="nav-icon">🏠</span>
                        <span class="nav-label" data-i18n="nav.home">ホーム</span>
                    </a>
                    <a href="#dashboard" class="nav-item" data-page="dashboard">
                        <span class="nav-icon">📊</span>
                        <span class="nav-label" data-i18n="nav.dashboard">PRダッシュボード</span>
                    </a>
                    <a href="#analytics" class="nav-item" data-page="analytics">
                        <span class="nav-icon">📈</span>
                        <span class="nav-label" data-i18n="nav.analytics">PR分析</span>
                    </a>
                    <a href="#fourkeys" class="nav-item" data-page="fourkeys">
                        <span class="nav-icon">🔑</span>
                        <span class="nav-label" data-i18n="nav.fourkeys">Four Keys</span>
                    </a>
                    <a href="#statistics" class="nav-item" data-page="statistics">
                        <span class="nav-icon">📊</span>
                        <span class="nav-label" data-i18n="nav.statistics">統計・レポート</span>
                    </a>
                    <a href="#file-history" class="nav-item" data-page="file-history">
                        <span class="nav-icon">📁</span>
                        <span class="nav-label" data-i18n="nav.filehistory">ファイル履歴</span>
                    </a>
                    <a href="#issues" class="nav-item" data-page="issues">
                        <span class="nav-icon">🎯</span>
                        <span class="nav-label" data-i18n="nav.issues">Issue管理</span>
                    </a>
                </nav>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Back Button - Hidden by default -->
            <button id="back-button" class="back-button" onclick="goBack()" style="display: none;">
                <span class="back-icon">←</span>
                <span class="back-label">戻る</span>
            </button>
            
            <!-- Global Repository Selection Info - Always Visible -->
            <div id="globalRepoInfo" class="global-repo-info">
                <div class="repo-info-content">
                    <span class="repo-info-icon">📁</span>
                    <span class="repo-info-label">現在のリポジトリ:</span>
                    <span id="globalRepoName" class="repo-info-name">すべてのリポジトリ</span>
                </div>
            </div>
            
            <!-- Home Page -->
            <div id="page-home" class="page active">
                <h1 data-i18n="home.title">GitHub PR Dashboard & Analytics</h1>
                
                <p class="lead-text" data-i18n="home.subtitle">
                    GitHubのPRを可視化・分析する統合ダッシュボード
                </p>

                <div class="feature-cards">
                    <div class="card">
                        <h3 data-i18n="home.features.title">主な機能</h3>
                        <ul>
                            <li><strong data-i18n="home.features.multi">マルチリポジトリ対応</strong>: <span data-i18n="home.features.multi.desc">複数リポジトリを一元管理</span></li>
                            <li><strong data-i18n="home.features.timeline">PRタイムライン</strong>: <span data-i18n="home.features.timeline.desc">ガントチャートでPRの進行状況を可視化</span></li>
                            <li><strong data-i18n="home.features.comment">コメントスレッド分析</strong>: <span data-i18n="home.features.comment.desc">指摘→返信→解決の流れを可視化</span></li>
                            <li><strong data-i18n="home.features.bottleneck">ボトルネック分析</strong>: <span data-i18n="home.features.bottleneck.desc">未応答時間を営業日ベースで計算</span></li>
                            <li><strong data-i18n="home.features.reviewer">レビュワー分析</strong>: <span data-i18n="home.features.reviewer.desc">誰がレビューに応答していないかを特定</span></li>
                            <li><strong data-i18n="home.features.speed">レビュー速度分析</strong>: <span data-i18n="home.features.speed.desc">作成からマージまでの時間分析</span></li>
                            <li><strong data-i18n="home.features.pattern">変更パターン分析</strong>: <span data-i18n="home.features.pattern.desc">ファイル変更頻度とPR規模分析</span></li>
                            <li><strong data-i18n="home.features.fourkeys">Four Keys指標</strong>: <span data-i18n="home.features.fourkeys.desc">DevOps Research and Assessmentの主要指標を測定</span></li>
                            <li><strong data-i18n="home.features.statistics">統計・週間レポート</strong>: <span data-i18n="home.features.statistics.desc">開発プロセスの統計分析と自動改善提案</span></li>
                        </ul>
                    </div>
                </div>

                <hr class="divider">

                <div id="cacheStatus" class="cache-status">
                    <div class="loading" data-i18n="home.cache.checking">Checking cache status...</div>
                </div>

                <hr class="divider">

                <div class="feature-grid">
                    <div class="feature-card" data-page="dashboard">
                        <h3 data-i18n="dashboard.title">PRダッシュボード</h3>
                        <p><strong data-i18n="dashboard.purpose">目的:</strong> <span data-i18n="dashboard.purpose.desc">PRの状態とファイル変更を時系列で把握</span></p>
                        <h4 data-i18n="dashboard.features.title">主な機能:</h4>
                        <ul>
                            <li><strong data-i18n="dashboard.timeline">PRタイムライン</strong>: <span data-i18n="dashboard.timeline.desc">ガントチャートでPRのライフサイクルを可視化</span></li>
                            <li><strong data-i18n="dashboard.files">書類/コード分析</strong>: <span data-i18n="dashboard.files.desc">ディレクトリごとのPRタイムライン</span></li>
                            <li><strong data-i18n="dashboard.action">アクション追跡</strong>: <span data-i18n="dashboard.action.desc">レビュー待ち/修正待ちPRの自動検出</span></li>
                        </ul>
                        <button class="btn btn-primary" onclick="navigateToPage('dashboard')" data-i18n="dashboard.open">
                            PRダッシュボードを開く
                        </button>
                    </div>

                    <div class="feature-card" data-page="analytics">
                        <h3 data-i18n="analytics.title">PR分析</h3>
                        <p><strong data-i18n="analytics.purpose">目的:</strong> <span data-i18n="analytics.purpose.desc">PRの統計分析と問題の早期発見</span></p>
                        <h4 data-i18n="analytics.features.title">7つの分析タブ:</h4>
                        <ul>
                            <li><span data-i18n="analytics.stagnation">滞留分析</span>: <span data-i18n="analytics.stagnation.desc">OPEN PRの滞留時間分布</span></li>
                            <li><span data-i18n="analytics.blocker">ブロッカー分析</span>: <span data-i18n="analytics.blocker.desc">未クローズ原因の推定</span></li>
                            <li><span data-i18n="analytics.reviewer">レビュワー分析</span>: <span data-i18n="analytics.reviewer.desc">レビューアクティビティ</span></li>
                            <li><span data-i18n="analytics.trend">トレンド分析</span>: <span data-i18n="analytics.trend.desc">週次PR作成数推移</span></li>
                            <li><span data-i18n="analytics.bottleneck">ボトルネック分析</span>: <span data-i18n="analytics.bottleneck.desc">レビュー待ち/修正待ちの詳細</span></li>
                            <li><span data-i18n="analytics.speed">レビュー速度</span>: <span data-i18n="analytics.speed.desc">マージまでの時間分析</span></li>
                            <li><span data-i18n="analytics.pattern">変更パターン</span>: <span data-i18n="analytics.pattern.desc">ファイル変更頻度とPR規模</span></li>
                        </ul>
                        <button class="btn btn-primary" onclick="navigateToPage('analytics')" data-i18n="analytics.open">
                            PR分析を開く
                        </button>
                    </div>

                    <div class="feature-card" data-page="fourkeys">
                        <h3 data-i18n="fourkeys.title">Four Keys</h3>
                        <p><strong data-i18n="fourkeys.purpose">目的:</strong> <span data-i18n="fourkeys.purpose.desc">DevOps Research and Assessment (DORA) の主要指標でソフトウェア開発のパフォーマンスを測定</span></p>
                        <h4 data-i18n="fourkeys.features.title">4つの主要指標:</h4>
                        <ul>
                            <li><strong>Deployment Frequency</strong>: <span data-i18n="fourkeys.deployment">デプロイ頻度 - 週あたりのデプロイ回数</span></li>
                            <li><strong>Lead Time for Changes</strong>: <span data-i18n="fourkeys.leadtime">変更のリードタイム - PR作成からマージまでの時間</span></li>
                            <li><strong>Change Failure Rate</strong>: <span data-i18n="fourkeys.failure">変更失敗率 - 失敗PRの割合</span></li>
                            <li><strong>Time to Restore Service</strong>: <span data-i18n="fourkeys.mttr">サービス復旧時間 (MTTR) - 問題解決までの時間</span></li>
                        </ul>
                        <button class="btn btn-primary" onclick="navigateToPage('fourkeys')" data-i18n="fourkeys.open">
                            Four Keysを開く
                        </button>
                    </div>

                    <div class="feature-card" data-page="statistics">
                        <h3 data-i18n="statistics.title">統計・レポート</h3>
                        <p><strong data-i18n="statistics.purpose">目的:</strong> <span data-i18n="statistics.purpose.desc">開発プロセスの現状分析と改善提案</span></p>
                        <h4 data-i18n="statistics.features.title">主な機能:</h4>
                        <ul>
                            <li><strong data-i18n="statistics.feature.summary">期間サマリー</strong>: <span data-i18n="statistics.feature.summary.desc">総PR数、マージ率、リードタイム</span></li>
                            <li><strong data-i18n="statistics.feature.trends">トレンド分析</strong>: <span data-i18n="statistics.feature.trends.desc">過去8週間のPR作成数と平均リードタイムの推移</span></li>
                            <li><strong data-i18n="statistics.feature.review">レビュー活動</strong>: <span data-i18n="statistics.feature.review.desc">総レビュー数、総コメント数</span></li>
                            <li><strong data-i18n="statistics.feature.insights">自動洞察</strong>: <span data-i18n="statistics.feature.insights.desc">開発活動の分析と問題検知</span></li>
                            <li><strong data-i18n="statistics.feature.recommendations">改善提案</strong>: <span data-i18n="statistics.feature.recommendations.desc">データに基づく具体的なアクション提案</span></li>
                            <li><strong data-i18n="statistics.feature.report">週間レポート</strong>: <span data-i18n="statistics.feature.report.desc">Markdown形式でのレポート出力</span></li>
                        </ul>
                        <button class="btn btn-primary" onclick="navigateToPage('statistics')" data-i18n="statistics.open">
                            統計・レポートを開く
                        </button>
                    </div>
                </div>

                <hr class="divider">

                <h2 data-i18n="home.usage.title">こんな時に使う</h2>
                <div class="usage-grid">
                    <div class="usage-card">
                        <h4>📊 PRダッシュボード</h4>
                        <ul>
                            <li>日次のPR確認</li>
                            <li>ファイル影響範囲の確認</li>
                            <li>コードレビューの優先順位付け</li>
                        </ul>
                    </div>
                    <div class="usage-card">
                        <h4>📈 PR分析</h4>
                        <ul>
                            <li>問題PRの早期発見</li>
                            <li>レビュワーの応答遅延検出</li>
                            <li>レトロスペクティブ</li>
                            <li>マネジメントレポート</li>
                        </ul>
                    </div>
                    <div class="usage-card">
                        <h4>🔑 Four Keys</h4>
                        <ul>
                            <li>DevOpsパフォーマンス測定</li>
                            <li>DORA指標の可視化</li>
                            <li>チーム改善の定量評価</li>
                        </ul>
                    </div>
                    <div class="usage-card">
                        <h4>📊 統計・レポート</h4>
                        <ul>
                            <li>週次・月次レポート作成</li>
                            <li>チームの改善活動</li>
                            <li>マネジメントへの報告</li>
                        </ul>
                    </div>
                </div>

                <hr class="divider">

                <div class="tips-grid">
                    <div class="tip-card tip-info">
                        <h4>📊 データ更新</h4>
                        <p>GitHub Actionsにより自動更新されます</p>
                        <ul>
                            <li>定期実行: 毎日自動更新</li>
                            <li>手動実行: Actions タブから実行可能</li>
                            <li>リアルタイム: 最新データを常に表示</li>
                        </ul>
                    </div>

                    <div class="tip-card tip-success">
                        <h4>⚡ 高速表示</h4>
                        <p>静的ページで瞬時に表示</p>
                        <ul>
                            <li>ページロード: 0.1秒以下</li>
                            <li>GitHub API呼び出し不要</li>
                            <li>Rate Limitの心配なし</li>
                        </ul>
                    </div>

                    <div class="tip-card tip-warning">
                        <h4>🔍 分析機能</h4>
                        <p>コメントスレッド分析で未応答を特定</p>
                        <ul>
                            <li>指摘→返信→解決の流れを追跡</li>
                            <li>営業日ベースの未応答時間</li>
                            <li>レビュワー別の応答率可視化</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page">
                <h1>PRダッシュボード</h1>
                
                <div class="dashboard-controls">
                    <div class="control-group">
                        <label for="stateFilter">状態:</label>
                        <select id="stateFilter" class="form-select" multiple>
                            <option value="OPEN" selected>Open</option>
                            <option value="MERGED" selected>Merged</option>
                            <option value="CLOSED">Closed</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="daysFilter">期間:</label>
                        <select id="daysFilter" class="form-select">
                            <option value="30">過去30日</option>
                            <option value="60">過去60日</option>
                            <option value="90" selected>過去90日</option>
                            <option value="180">過去180日</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" onclick="loadDashboardData()">
                        更新
                    </button>
                </div>

                <div class="metrics-row" id="dashboardMetrics">
                    <!-- Metrics will be inserted here -->
                </div>

                <!-- Risky PRs Section -->
                <div class="chart-container" style="margin-bottom: 2rem;">
                    <h2 style="margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 1.5rem;">🚨</span>
                        注意が必要なPR
                    </h2>
                    <div id="riskyPRsContainer">
                        <div class="loading">Loading...</div>
                    </div>
                </div>

                <!-- Action Tracker Section -->
                <div class="chart-container" style="margin-bottom: 2rem;">
                    <h2 style="margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 1.5rem;">✋</span>
                        アクション必要なPR
                    </h2>
                    <div id="actionTrackerContainer">
                        <div class="loading">Loading...</div>
                    </div>
                </div>

                <div class="chart-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h2 style="margin: 0;">PRタイムライン</h2>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <label for="timelineLimit" style="font-size: 0.9rem; color: var(--text-muted);">表示件数:</label>
                            <select id="timelineLimit" class="sidebar-select" style="width: auto; padding: 0.4rem 0.8rem;" onchange="handleTimelineLimitChange()">
                                <option value="10">10件</option>
                                <option value="20">20件</option>
                                <option value="30" selected>30件</option>
                                <option value="50">50件</option>
                                <option value="100">100件</option>
                                <option value="all">すべて</option>
                            </select>
                        </div>
                    </div>
                    <div id="timelineChart" class="chart-area">
                        <div class="loading">Loading chart...</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h2>PR一覧</h2>
                    <div id="prTable" class="table-container">
                        <div class="loading">Loading table...</div>
                    </div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="page-analytics" class="page">
                <h1>PR分析</h1>
                
                <div class="tabs">
                    <button class="tab-btn active" data-tab="residence">滞留分析</button>
                    <button class="tab-btn" data-tab="blocker">ブロッカー分析</button>
                    <button class="tab-btn" data-tab="reviewer">レビュワー分析</button>
                    <button class="tab-btn" data-tab="trend">トレンド分析</button>
                    <button class="tab-btn" data-tab="bottleneck">ボトルネック分析</button>
                    <button class="tab-btn" data-tab="speed">レビュー速度</button>
                    <button class="tab-btn" data-tab="pattern">変更パターン</button>
                </div>

                <div class="tab-content">
                    <div id="tab-residence" class="tab-pane active">
                        <h2>滞留分析</h2>
                        <p>Open PRの滞留時間分布 - PRがどのくらいOpenのまま残っているかを分析</p>
                        <div id="residenceSummary" class="summary-container"></div>
                        <div id="residenceChart" class="chart-area">
                            <div class="loading">Loading chart...</div>
                        </div>
                    </div>

                    <div id="tab-blocker" class="tab-pane">
                        <h2>ブロッカー分析</h2>
                        <p>未クローズ原因の推定 - 各PRがなぜ未完了なのかを分析</p>
                        <div id="blockerChart" class="chart-area">
                            <div class="loading">Loading chart...</div>
                        </div>
                        <div id="blockerTable"></div>
                    </div>

                    <div id="tab-reviewer" class="tab-pane">
                        <h2>レビュワー分析</h2>
                        <p>レビューアクティビティとコメント応答状況 - 誰がどれだけレビューしているかを分析</p>
                        <div id="reviewerSummary" class="summary-container"></div>
                        <div id="reviewerChart" class="chart-area">
                            <div class="loading">Loading chart...</div>
                        </div>
                        <div id="reviewerDetails"></div>
                    </div>

                    <div id="tab-trend" class="tab-pane">
                        <h2>トレンド分析</h2>
                        <p>週次PR作成数推移</p>
                        <div id="trendChart" class="chart-area">
                            <div class="loading">Loading chart...</div>
                        </div>
                    </div>

                    <div id="tab-bottleneck" class="tab-pane">
                        <h2>ボトルネック分析</h2>
                        <p>レビュー待ち/修正待ちの詳細</p>
                        <div id="bottleneckChart" class="chart-area">
                            <div class="loading">Loading chart...</div>
                        </div>
                    </div>

                    <div id="tab-speed" class="tab-pane">
                        <h2>レビュー速度</h2>
                        <p>マージまでの時間分析</p>
                        <div id="speedChart" class="chart-area">
                            <div class="loading">Loading chart...</div>
                        </div>
                    </div>

                    <div id="tab-pattern" class="tab-pane">
                        <h2>変更パターン</h2>
                        <p>ファイル変更頻度とPR規模</p>
                        <div id="patternChart" class="chart-area">
                            <div class="loading">Loading chart...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Four Keys Page -->
            <div id="page-fourkeys" class="page">
                <div class="page-header">
                    <h1 data-i18n="fourkeys.title">🔑 Four Keys メトリクス</h1>
                    <p class="page-subtitle" data-i18n="fourkeys.subtitle">
                        DevOps Research and Assessment (DORA) の 4つの主要指標でソフトウェア開発のパフォーマンスを測定<br>
                        <small style="color: var(--text-muted); font-size: 0.9rem;">💡 サイドバーのリポジトリフィルタで特定のリポジトリに絞り込めます</small>
                    </p>
                </div>
                
                <div class="dev-banner" id="fourkeys-dev-banner">
                    <div class="dev-banner-content">
                        <span class="dev-banner-icon">⚠️</span>
                        <div>
                            <h3>データが読み込めませんでした</h3>
                            <p>Four Keys メトリクスのデータファイル (fourkeys.json) が見つからないか、読み込みに失敗しました。</p>
                            <p>データは GitHub Actions により自動生成されます。しばらくお待ちください。</p>
                        </div>
                    </div>
                </div>

                <div id="fourkeys-content">
                    <!-- 1. サマリーセクション -->
                    <div class="chart-section">
                        <h2>📊 メトリクスサマリー</h2>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">現在のパフォーマンスレベルを一目で確認</p>
                        <div class="metrics-grid">
                            <div class="metric-card modern-card" id="deployment-frequency">
                                <div class="metric-card-header">
                                    <span class="metric-icon">📦</span>
                                    <h3>Deployment Frequency</h3>
                                </div>
                                <div class="metric-card-body">
                                    <div class="metric-value-container">
                                        <p class="metric-value loading">-</p>
                                        <p class="metric-unit"></p>
                                    </div>
                                    <p class="metric-description">デプロイ頻度</p>
                                    <div class="metric-badge"></div>
                                </div>
                            </div>

                            <div class="metric-card modern-card" id="lead-time">
                                <div class="metric-card-header">
                                    <span class="metric-icon">⏱️</span>
                                    <h3>Lead Time for Changes</h3>
                                </div>
                                <div class="metric-card-body">
                                    <div class="metric-value-container">
                                        <p class="metric-value loading">-</p>
                                        <p class="metric-unit"></p>
                                    </div>
                                    <p class="metric-description">変更のリードタイム</p>
                                    <div class="metric-badge"></div>
                                </div>
                            </div>

                            <div class="metric-card modern-card" id="change-failure-rate">
                                <div class="metric-card-header">
                                    <span class="metric-icon">❌</span>
                                    <h3>Change Failure Rate</h3>
                                </div>
                                <div class="metric-card-body">
                                    <div class="metric-value-container">
                                        <p class="metric-value loading">-</p>
                                        <p class="metric-unit"></p>
                                    </div>
                                    <p class="metric-description">変更失敗率</p>
                                    <div class="metric-badge"></div>
                                </div>
                            </div>

                            <div class="metric-card modern-card" id="mttr">
                                <div class="metric-card-header">
                                    <span class="metric-icon">🔧</span>
                                    <h3>Time to Restore Service</h3>
                                </div>
                                <div class="metric-card-body">
                                    <div class="metric-value-container">
                                        <p class="metric-value loading">-</p>
                                        <p class="metric-unit"></p>
                                    </div>
                                    <p class="metric-description">サービス復旧時間 (MTTR)</p>
                                    <div class="metric-badge"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. 総合ビューセクション -->
                    <div class="chart-section">
                        <h2>🎯 総合パフォーマンスビュー</h2>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">4つのメトリクスのバランスをレーダーチャートで可視化</p>
                        <div id="fourkeys-radar-chart" class="chart-container" style="height: 500px;"></div>
                    </div>

                    <!-- 3. トレンド分析セクション -->
                    <div class="chart-section">
                        <h2>📈 トレンド分析</h2>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">各メトリクスの時系列推移を確認</p>
                        <div class="fourkeys-quadrant-grid">
                            <div class="quadrant-item">
                                <h3>Deployment Frequency</h3>
                                <div id="fourkeys-quad-df" class="chart-container" style="height: 300px;"></div>
                                <div class="quadrant-metric" id="quad-df-metric"></div>
                            </div>
                            <div class="quadrant-item">
                                <h3>Lead Time for Changes</h3>
                                <div id="fourkeys-quad-lt" class="chart-container" style="height: 300px;"></div>
                                <div class="quadrant-metric" id="quad-lt-metric"></div>
                            </div>
                            <div class="quadrant-item">
                                <h3>Change Failure Rate</h3>
                                <div id="fourkeys-quad-cfr" class="chart-container" style="height: 300px;"></div>
                                <div class="quadrant-metric" id="quad-cfr-metric"></div>
                            </div>
                            <div class="quadrant-item">
                                <h3>Mean Time to Restore</h3>
                                <div id="fourkeys-quad-mttr" class="chart-container" style="height: 300px;"></div>
                                <div class="quadrant-metric" id="quad-mttr-metric"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 4. 詳細分析セクション -->
                    <div class="chart-section">
                        <h2>🔍 詳細分析</h2>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">各メトリクスの詳細データと分布を確認</p>
                        <div class="tabs">
                            <button class="tab-btn active" data-tab="df-detail">Deployment Frequency</button>
                            <button class="tab-btn" data-tab="lt-detail">Lead Time</button>
                            <button class="tab-btn" data-tab="cfr-detail">Change Failure Rate</button>
                            <button class="tab-btn" data-tab="mttr-detail">MTTR</button>
                        </div>
                        <div class="tab-content">
                            <div id="tab-df-detail" class="tab-pane active">
                                <div id="fourkeys-df-detail" class="chart-container" style="height: 400px;"></div>
                                <div id="fourkeys-df-table"></div>
                            </div>
                            <div id="tab-lt-detail" class="tab-pane">
                                <div id="fourkeys-lt-detail" class="chart-container" style="height: 400px;"></div>
                                <div id="fourkeys-lt-table"></div>
                            </div>
                            <div id="tab-cfr-detail" class="tab-pane">
                                <div id="fourkeys-cfr-detail" class="chart-container" style="height: 400px;"></div>
                                <div id="fourkeys-cfr-table"></div>
                            </div>
                            <div id="tab-mttr-detail" class="tab-pane">
                                <div id="fourkeys-mttr-detail" class="chart-container" style="height: 400px;"></div>
                                <div id="fourkeys-mttr-table"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 5. 改善アクションセクション -->
                    <div class="chart-section">
                        <h2>💡 改善アクション</h2>
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">各メトリクスを向上させるための具体的な施策</p>
                        <div class="improvement-hints">
                            <div class="hint-card">
                                <h4>Deployment Frequency を上げるには:</h4>
                                <ul>
                                    <li>PR サイズを小さくする</li>
                                    <li>CI/CD パイプラインを高速化</li>
                                    <li>フィーチャーフラグを活用</li>
                                </ul>
                            </div>
                            <div class="hint-card">
                                <h4>Lead Time を短縮するには:</h4>
                                <ul>
                                    <li>PRレビューを迅速化</li>
                                    <li>自動テストを充実</li>
                                    <li>PR作成前のコミュニケーション強化</li>
                                </ul>
                            </div>
                            <div class="hint-card">
                                <h4>Change Failure Rate を下げるには:</h4>
                                <ul>
                                    <li>テストカバレッジ向上</li>
                                    <li>Canary デプロイメント導入</li>
                                    <li>プレプロダクション環境の活用</li>
                                </ul>
                            </div>
                            <div class="hint-card">
                                <h4>MTTR を短縮するには:</h4>
                                <ul>
                                    <li>モニタリング・アラート強化</li>
                                    <li>ロールバック手順の自動化</li>
                                    <li>インシデント対応訓練</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Page -->
            <div id="page-statistics" class="page">
                <div class="page-header">
                    <h1 data-i18n="statistics.title">📊 統計情報・週間レポート</h1>
                    <p class="page-subtitle" data-i18n="statistics.subtitle">
                        開発プロセスの現状を理解し、改善の機会を見つけるための包括的な統計情報
                    </p>
                </div>

                <!-- Controls -->
                <div class="statistics-controls">
                    <div class="control-group">
                        <label for="viewModeSelect">表示モード:</label>
                        <select id="viewModeSelect" class="form-select">
                            <option value="current">現在の期間</option>
                            <option value="historical-weekly">過去週単位</option>
                            <option value="historical-monthly">過去月単位</option>
                            <option value="historical-yearly">過去年単位</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="periodSelect" data-i18n="statistics.period">レポート期間:</label>
                        <select id="periodSelect" class="form-select">
                            <option value="thisWeek">今週</option>
                            <option value="lastWeek">先週</option>
                            <option value="thisMonth">今月</option>
                            <option value="lastMonth">先月</option>
                            <option value="last30days">過去30日</option>
                            <option value="last90days">過去90日</option>
                        </select>
                    </div>
                    <div id="historicalSelectContainer" class="control-group" style="display: none;">
                        <label for="historicalSelect">選択:</label>
                        <select id="historicalSelect" class="form-select">
                        </select>
                    </div>
                    <button id="downloadReport" class="btn btn-primary" data-i18n="statistics.download">
                        📄 週間レポートをダウンロード
                    </button>
                </div>

                <!-- Summary Cards -->
                <div class="statistics-summary">
                    <h2 data-i18n="statistics.summary">📅 期間サマリー</h2>
                    <div class="metrics-grid">
                        <div class="metric-card modern-card" id="totalPRsCard">
                            <div class="metric-card-header">
                                <span class="metric-icon">📋</span>
                                <h3 data-i18n="statistics.total_prs">総PR数</h3>
                            </div>
                            <div class="metric-card-body">
                                <div class="metric-value-container">
                                    <p class="metric-value">-</p>
                                </div>
                                <p class="metric-delta"></p>
                            </div>
                        </div>

                        <div class="metric-card modern-card" id="mergedPRsCard">
                            <div class="metric-card-header">
                                <span class="metric-icon">✅</span>
                                <h3 data-i18n="statistics.merged">マージ済み</h3>
                            </div>
                            <div class="metric-card-body">
                                <div class="metric-value-container">
                                    <p class="metric-value">-</p>
                                </div>
                                <p class="metric-delta"></p>
                            </div>
                        </div>

                        <div class="metric-card modern-card" id="leadTimeCard">
                            <div class="metric-card-header">
                                <span class="metric-icon">⏱️</span>
                                <h3 data-i18n="statistics.lead_time">平均リードタイム</h3>
                            </div>
                            <div class="metric-card-body">
                                <div class="metric-value-container">
                                    <p class="metric-value">-</p>
                                </div>
                                <p class="metric-delta"></p>
                            </div>
                        </div>

                        <div class="metric-card modern-card" id="activeAuthorsCard">
                            <div class="metric-card-header">
                                <span class="metric-icon">👥</span>
                                <h3 data-i18n="statistics.active_authors">アクティブ開発者</h3>
                            </div>
                            <div class="metric-card-body">
                                <div class="metric-value-container">
                                    <p class="metric-value">-</p>
                                </div>
                                <p class="metric-delta"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="statistics-charts">
                    <div class="chart-row">
                        <div class="chart-container half-width">
                            <h3 data-i18n="statistics.state_breakdown">PR状態の内訳</h3>
                            <div id="stateChart" class="chart-placeholder"></div>
                        </div>
                        <div class="chart-container half-width">
                            <h3 data-i18n="statistics.review_activity">レビュー活動</h3>
                            <div id="reviewMetrics" class="review-metrics"></div>
                        </div>
                    </div>
                </div>

                <!-- Trends Section -->
                <div class="statistics-trends">
                    <h2 data-i18n="statistics.trends">📈 トレンド分析（過去8週間）</h2>
                    <div class="chart-row">
                        <div class="chart-container half-width">
                            <h3 data-i18n="statistics.pr_count_trend">PR作成数の推移</h3>
                            <div id="trendPRChart" class="chart-placeholder"></div>
                        </div>
                        <div class="chart-container half-width">
                            <h3 data-i18n="statistics.lead_time_trend">平均リードタイムの推移</h3>
                            <div id="trendLeadTimeChart" class="chart-placeholder"></div>
                        </div>
                    </div>
                    
                    <!-- New Review Activity Trends -->
                    <h3 style="margin-top: 2rem;">🔍 レビュー活動のトレンド</h3>
                    <div class="chart-row">
                        <div class="chart-container half-width">
                            <h4>平均レビュー時間の推移</h4>
                            <div id="trendReviewTimeChart" class="chart-placeholder"></div>
                        </div>
                        <div class="chart-container half-width">
                            <h4>レビューの深さの推移</h4>
                            <div id="trendReviewDepthChart" class="chart-placeholder"></div>
                        </div>
                    </div>
                    <div class="chart-row">
                        <div class="chart-container half-width">
                            <h4>平均PRサイズの推移</h4>
                            <div id="trendPRSizeChart" class="chart-placeholder"></div>
                        </div>
                    </div>
                </div>

                <!-- Insights Section -->
                <div class="statistics-insights">
                    <h2 data-i18n="statistics.insights">💡 洞察</h2>
                    <div id="insightsContainer" class="insights-container">
                        <div class="loading" data-i18n="statistics.loading_insights">データを分析中...</div>
                    </div>
                </div>

                <!-- Recommendations Section -->
                <div class="statistics-recommendations">
                    <h2 data-i18n="statistics.recommendations">🎯 改善提案</h2>
                    <div id="recommendationsContainer" class="recommendations-container">
                        <div class="loading" data-i18n="statistics.loading_recommendations">提案を生成中...</div>
                    </div>
                </div>
            </div>

            <!-- Issues Page -->
            <div id="page-issues" class="page">
                <h1 data-i18n="issues.title">🎯 Issue管理・分析</h1>
                <p class="page-description" data-i18n="issues.description">
                    Issueの追跡、サイクルタイム分析、マイルストーン管理、チーム速度の可視化
                </p>

                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab active" data-tab="overview" onclick="switchIssuesTab('overview')" data-i18n="issues.tab.overview">概要</button>
                    <button class="tab" data-tab="timeline" onclick="switchIssuesTab('timeline')" data-i18n="issues.tab.timeline">タイムライン</button>
                    <button class="tab" data-tab="cycle-time" onclick="switchIssuesTab('cycle-time')" data-i18n="issues.tab.cycle_time">サイクルタイム</button>
                    <button class="tab" data-tab="issue-pr-link" onclick="switchIssuesTab('issue-pr-link')" data-i18n="issues.tab.issue_pr">Issue-PR連携</button>
                    <button class="tab" data-tab="milestone" onclick="switchIssuesTab('milestone')" data-i18n="issues.tab.milestone">マイルストーン</button>
                    <button class="tab" data-tab="velocity" onclick="switchIssuesTab('velocity')" data-i18n="issues.tab.velocity">チーム速度</button>
                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Overview Tab -->
                    <div id="tab-overview" class="tab-panel active">
                        <div id="issuesOverviewCharts">
                            <div class="loading">Loading...</div>
                        </div>
                    </div>

                    <!-- Timeline Tab -->
                    <div id="tab-timeline" class="tab-panel">
                        <div id="issuesTimelineChart">
                            <div class="loading">Loading...</div>
                        </div>
                    </div>

                    <!-- Cycle Time Tab -->
                    <div id="tab-cycle-time" class="tab-panel">
                        <div id="cycleTimeChart">
                            <div class="loading">Loading...</div>
                        </div>
                    </div>

                    <!-- Issue-PR Link Tab -->
                    <div id="tab-issue-pr-link" class="tab-panel">
                        <div id="issuePRLinkChart">
                            <div class="loading">Loading...</div>
                        </div>
                    </div>

                    <!-- Milestone Tab -->
                    <div id="tab-milestone" class="tab-panel">
                        <div id="milestoneChart">
                            <div class="loading">Loading...</div>
                        </div>
                    </div>

                    <!-- Velocity Tab -->
                    <div id="tab-velocity" class="tab-panel">
                        <div id="velocityChart">
                            <div class="loading">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PR Detail Page -->
            <div id="page-pr-detail" class="page">
                <div style="margin-bottom: 1rem;">
                    <button onclick="navigateToPage('dashboard')" style="background: var(--secondary-color); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">
                        ← ダッシュボードに戻る
                    </button>
                </div>

                <div id="pr-detail-content">
                    <div class="loading">Loading PR details...</div>
                </div>
            </div>

            <!-- File History Page -->
            <div id="page-file-history" class="page">
                <h1 style="margin-bottom: 1rem;">📁 ファイル別PR履歴</h1>
                <p style="color: var(--text-muted); margin-bottom: 1.5rem;">
                    ファイルやディレクトリを選択して、関連するPRの更新履歴・会話履歴を確認できます
                </p>

                <!-- Search Box -->
                <div style="margin-bottom: 1rem;">
                    <input type="text" id="file-search-input" placeholder="🔍 ファイルを検索..." 
                           onkeyup="filterFileTree()"
                           style="width: 100%; padding: 0.75rem 1rem; border: 2px solid var(--border-color); border-radius: 8px; font-size: 0.95rem; background: var(--card-bg); color: var(--text-color);">
                </div>

                <!-- Split Layout: Tree on left, Details on right -->
                <div class="file-history-layout">
                    <!-- Left Panel: File Tree -->
                    <div class="file-tree-panel">
                        <div class="file-tree-header">
                            <h3 style="margin: 0; font-size: 0.9rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">エクスプローラー</h3>
                        </div>
                        <div id="file-tree-container" class="file-tree-content">
                            <div class="loading">Loading file tree...</div>
                        </div>
                    </div>

                    <!-- Right Panel: PR Details -->
                    <div class="file-details-panel">

                    <div id="file-pr-list-container" style="display: none;">
                        <h2 id="file-selected-path"></h2>
                        
                        <!-- PR統計カード -->
                        <div class="metrics-grid" style="margin-bottom: 2rem;">
                            <div class="metric-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                <div class="metric-icon">📝</div>
                                <div class="metric-value" id="file-total-prs">0</div>
                                <div class="metric-label">総PR数</div>
                            </div>
                            
                            <div class="metric-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                                <div class="metric-icon">🟢</div>
                                <div class="metric-value" id="file-open-prs">0</div>
                                <div class="metric-label">オープン中</div>
                            </div>
                            
                            <div class="metric-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                                <div class="metric-icon">✅</div>
                                <div class="metric-value" id="file-merged-prs">0</div>
                                <div class="metric-label">マージ済み</div>
                            </div>
                            
                            <div class="metric-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white;">
                                <div class="metric-icon">📅</div>
                                <div class="metric-value" id="file-last-update">-</div>
                                <div class="metric-label">最終更新</div>
                            </div>
                        </div>

                        <!-- PRタイムライン -->
                        <div id="file-pr-timeline-chart" style="height: 400px; margin-bottom: 2rem;"></div>

                        <!-- PR一覧テーブル -->
                        <div id="file-pr-table-container"></div>
                    </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/config.js?v=20251113-17"></script>
    <script src="js/utils.js?v=20251113-18"></script>
    <script src="js/action-tracker.js?v=20251113-18"></script>
    <script src="js/app.js?v=20251113-18"></script>
    <script src="js/dashboard.js?v=20251113-18"></script>
    <script src="js/analytics.js?v=20251113-18"></script>
    <script src="js/fourkeys.js?v=20251113-18"></script>
    <script src="js/statistics.js?v=20251113-18"></script>
    <script src="js/issues.js?v=20251113-18"></script>
    <script src="js/pr-detail.js?v=20251113-18"></script>
    <script src="js/file-history.js?v=20251113-18"></script>
</body>
</html>
