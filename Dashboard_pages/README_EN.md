# GitHub PR Dashboard - GitHub Pages Version

A static web application that migrates the Streamlit-based dashboard to GitHub Pages + Actions.

[日本語](README.md) | English

## Overview

This directory contains a static PR dashboard that can be hosted on GitHub Pages.
GitHub Actions periodically fetches PR data and saves it as JSON files, which are visualized on static HTML pages.

### Key Features

- **Fully Static**: No server required, runs on GitHub Pages
- **Auto Update**: Daily automatic data fetching via GitHub Actions
- **Fast Display**: Instant display by loading local files
- **Streamlit-style UI**: Follows the design of the original Streamlit dashboard
- **Multi-Repository Support**: Manage multiple repositories in one place
- **Responsive Design**: Works on PC/Tablet/Mobile
- **Bilingual Support**: Japanese and English interface with language toggle

## Directory Structure

```
Dashboard_pages/
├── index.html           # Main HTML file
├── css/
│   └── style.css       # Stylesheet (Streamlit-inspired design)
├── js/
│   ├── config.js       # Configuration file
│   ├── i18n.js         # Internationalization support
│   ├── app.js          # Main application logic
│   ├── dashboard.js    # Dashboard page logic
│   └── analytics.js    # Analytics page logic
├── data/               # Generated JSON data (auto-generated by GitHub Actions)
│   ├── config.json     # Repository configuration
│   ├── prs.json        # PR data
│   ├── analytics.json  # Analytics data
│   └── cache_info.json # Cache information
├── generate_data.py    # Data generation script
└── README.md          # This file
```

## Setup

### Method 1: GitHub Actions Auto Deploy (Recommended)

1. **Update Repository Configuration**

   Edit `dashboard/config.py` to set your repositories:
   
   ```python
   REPOSITORIES = [
       {
           "name": "Your Project",
           "owner": "your-org",
           "repo": "your-repo"
       },
   ]
   ```

2. **Enable GitHub Pages**

   In your repository Settings > Pages:
   - Source: Select `GitHub Actions`
   - Save

3. **Configure GitHub Token and Permissions**

   **Important: Check Actions Permissions**
   
   The default `GITHUB_TOKEN` can be used to fetch PR data from public repositories.
   
   **Required Permissions:**
   - `contents: read` - Repository checkout (enabled by default)
   - `pages: write` - Deploy to GitHub Pages (already set in workflow)
   - `id-token: write` - GitHub Pages authentication (already set in workflow)
   
   **You need a Personal Access Token (PAT) if:**
   - Fetching PR data from private repositories
   - Additional permissions are needed for organization repositories
   - The default `GITHUB_TOKEN` has insufficient permissions
   
   **How to create a PAT:**
   1. Go to GitHub Settings > Developer settings > Personal access tokens > Tokens (classic)
   2. Click "Generate new token (classic)"
   3. Select required scopes:
      - `repo` (for private repositories)
      - `public_repo` (for public repositories)
   4. Generate and copy the token
   
   **Configure the PAT:**
   - Go to repository Settings > Secrets and variables > Actions
   - Click "New repository secret"
   - Name: `GH_PAT`
   - Value: Your generated Personal Access Token
   
   Then update lines 50-52 in `.github/workflows/deploy-pages.yml`:
   ```yaml
   - name: Fetch PR data from GitHub API
     env:
       GITHUB_TOKEN: ${{ secrets.GH_PAT }}  # ← Changed from secrets.GITHUB_TOKEN
   ```

4. **Run the Workflow**

   - Open the Actions tab
   - Select "Deploy GitHub PR Dashboard to Pages"
   - Click "Run workflow"

5. **Access the Dashboard**

   Access at `https://<username>.github.io/<repository>/`

### Method 2: Local Testing

#### Option A: Quick Start with Sample Data

1. **Use Sample Data**

   ```bash
   cd Dashboard_pages/data
   cp sample_prs.json prs.json
   ```

2. **Start Local Server**

   ```bash
   cd ..
   # Use Python's simple server
   python -m http.server 8000
   
   # Or Node.js http-server
   npx http-server
   ```

3. **Access in Browser**

   Open `http://localhost:8000`

#### Option B: Use Real Data

1. **Generate Data**

   ```bash
   # Fetch data from existing Streamlit dashboard
   cd dashboard
   python fetch_data.py --all
   
   # Generate static JSON files
   cd ../Dashboard_pages
   python generate_data.py
   ```

2. **Start Local Server**

   ```bash
   # Use Python's simple server
   python -m http.server 8000
   
   # Or Node.js http-server
   npx http-server
   ```

3. **Access in Browser**

   Open `http://localhost:8000`

## Configuration

### Change Monitored Repositories

Edit `dashboard/config.py`:

```python
REPOSITORIES = [
    {
        "name": "Display Name",
        "owner": "GitHub Owner",
        "repo": "Repository Name"
    },
    # Add more as needed
]
```

### Change Update Frequency

Edit the schedule in `.github/workflows/deploy-pages.yml`:

```yaml
schedule:
  # Daily at 2 AM (UTC)
  - cron: '0 2 * * *'
  
  # For hourly execution
  # - cron: '0 * * * *'
  
  # For weekly Monday at 2 AM
  # - cron: '0 2 * * 1'
```

### UI Customization

- **Colors**: `:root` section in `css/style.css`
- **Charts**: `charts` section in `js/config.js`
- **Default Display**: `ui` section in `js/config.js`
- **Language**: Use the language toggle button (EN/JA) in the UI

## Features

### Home Page

- Repository selection
- Cache status display
- Navigation to each page
- Language toggle (English/Japanese)

### PR Dashboard

- **PR Timeline**: Visualize PR lifecycle in Gantt chart format
- **Metrics**: Count of Open/Merged/Closed, average merge time
- **PR List**: Filterable detailed table

### PR Analytics

7 analysis tabs:

1. **Stagnation Analysis**: Distribution of open PR duration
2. **Blocker Analysis**: Estimate causes for unclosed PRs
3. **Reviewer Analysis**: Review activity
4. **Trend Analysis**: Weekly PR creation trends
5. **Bottleneck Analysis**: Identify long-stagnant PRs
6. **Review Speed**: Time analysis from creation to merge
7. **Change Pattern**: File change frequency and PR size

### Four Keys (In Development)

DevOps Four Keys metrics measurement feature (to be implemented)

## Data Flow

```
┌─────────────────────┐
│  GitHub API         │
│  (PR Data)          │
└─────────┬───────────┘
          │
          │ fetch_data.py
          ↓
┌─────────────────────┐
│  SQLite Cache       │
│  (pr_cache.db)      │
└─────────┬───────────┘
          │
          │ generate_data.py
          ↓
┌─────────────────────┐
│  JSON Files         │
│  (data/*.json)      │
└─────────┬───────────┘
          │
          │ JavaScript
          ↓
┌─────────────────────┐
│  Dashboard UI       │
│  (Browser Display)  │
└─────────────────────┘
```

## Troubleshooting

### Data Not Displaying

1. Check if `data/prs.json` exists
2. Check browser console for errors
3. Check GitHub Actions logs

### GitHub Actions Failing

**Symptom:** "Fetch PR data from GitHub API" step fails

**Causes and Solutions:**

1. **Insufficient Permissions**
   - Error message contains "403 Forbidden" or "Resource not accessible by integration"
   - **Solution:** Create and configure a Personal Access Token (PAT) (see "Configure GitHub Token and Permissions" above)
   - Even for public repositories, organization repos may require additional permissions

2. **Repository Configuration**
   - Verify repository name and owner in `dashboard/config.py` are correct
   - Confirm the repository exists and is accessible

3. **Rate Limit**
   - Check if GitHub API rate limit has been reached
   - Default `GITHUB_TOKEN` allows 1,000 requests/hour
   - Using PAT increases limit to 5,000 requests/hour

4. **Actions Permissions Settings**
   - Go to repository Settings > Actions > General > Workflow permissions
   - "Read and write permissions" may be needed in some cases (usually not required)

### Page 404 Error

1. Verify GitHub Pages is enabled
2. Check if workflow completed successfully
3. Verify repository is public or GitHub Pages settings are correct

## Key Changes from Streamlit Version

| Feature | Streamlit Version | Pages Version |
|---------|------------------|---------------|
| Runtime | Local PC | GitHub Pages |
| Data Fetching | Manual/Scheduled | GitHub Actions (Automatic) |
| Display Method | Python/Streamlit | HTML/CSS/JavaScript |
| Updates | Real-time | Periodic (Default: Daily) |
| Interaction | Python-side processing | Client-side JavaScript |
| Charts | Plotly (Python) | Plotly.js |
| Language | Japanese only | Japanese/English toggle |

## Design

Follows these Streamlit design elements:

- Sidebar navigation
- Color scheme (Red/Green/Blue accent colors)
- Card-based layout
- Clean and minimal UI
- Responsive design
- Bilingual interface (Japanese/English)

## Security

- GitHub Token managed in GitHub Actions secrets
- Only static files published, no server-side processing
- Private repository data can be safely processed

## License

This project is provided under the same license as the original repository.

## Contributing

Bug reports and feature requests are welcome at [Issues](../../issues).

## Related Documentation

- [Original Streamlit Version README](../dashboard/README.md)
- [GitHub Pages Documentation](https://docs.github.com/en/pages)
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
